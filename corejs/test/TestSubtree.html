<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>TestSubtree</title>
		<script src="../lib/require.js"></script>
		<script>
			require.config({
		    	baseUrl: "../src"
			});		
			require(["gmestorage", "gmesubtree"], function(gmestorage, gmesubtree) {

				var printNode = function (container, path, node) {
					var newNode = document.createElement("div");
					newNode.innerHTML = path + " <span class='subLevel'>(name: " + node.data.name + ", hash: " + node.data.hash + ")</span>";
					container.appendChild(newNode);
					
					if(node.children) {
						for(var relid in node.children) {
							printNode(newNode, path + "/" + relid, node.children[relid]);
						}
					}
				}

				console.log("START");
				var project = gmestorage.createProject();
				var subtree = gmesubtree.createProject(project);

				project.onopen = function () {
					var request = project.createRequest();
					request.loadRoot();
					request.ondone = function () {
						var root = request.root;

						// create another request
						subtree.loadTree(root, {recursive_children: true}, function (root) {
							printNode(document.getElementById("myContent"), "", root);
							gmesubtree.unloadTree(root);
							project.close();
						});
					}
					request.send();
				}
				project.onclose = function () {
					console.log("DONE");
				};
				project.open("sample");
			});
		</script>
		<style>
			.subLevel { margin-left: 100px; }
		</style>
	</head>
	<body>
		<div id="myContent" style="font-family: Courier new">
		</div>
	</body>
</html>
