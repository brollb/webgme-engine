<!DOCTYPE html>
<html>
    <head>
        <title>TreeBrowser test</title>

        <!-- CSS libraries -->
        <link href="css/main.css" type="text/css" rel="stylesheet"/>
        <link href="css/dynatree/ui.dynatree.css" rel="stylesheet" type="text/css">
        <!-- // CSS libraries -->

        <!-- JS libraries -->
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui.min.js"></script>
        <script type="text/javascript" src="js/jquery.dynatree.min.js"></script>
        <script type="text/javascript" src="js/jquery.jstree.js"></script>
        <script type="text/javascript" src="js/TreeBrowserWidget.js"></script>
        <script type="text/javascript" src="js/JSTreeBrowserWidget.js"></script>
        <!-- // External JS libraries -->

        <script type="text/javascript">

        /*********
         * UTILITY HELPERS
         */

          function S4() {
              return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
          }

          function guid() {
              return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
          }

          function logMessage( msg )
          {
              if ( window.console ) {
                  var d = new Date();
                  console.log( d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds() + "." + d.getMilliseconds() + ": " + msg );
              }
          }

        /*********
         * DOCUMENT READY
         */

          $(document).ready(function(){
              /*************TreeBrowserWidget with DYNATREE *********************/
              var treeBrowser = new TreeBrowserWidget( "dTreeBrowser" );

              //toplevel items
              var node1 = treeBrowser.createNode( null, { name: "Node1", hasChildren : true } );
              var node2 = treeBrowser.createNode( null, { name: "Node2", hasChildren : true } );
              var node3 = treeBrowser.createNode( null, { name: "Node3", hasChildren : true } );
              var node4 = treeBrowser.createNode( null, { name: "Node4", hasChildren : true } );
              var node5 = treeBrowser.createNode( null, { name: "Node5", hasChildren : false } );

              var node11 = treeBrowser.createNode( node1, { name: "Node1_1", hasChildren : true } );
              var node12 = treeBrowser.createNode( node1, { name: "Node1_2", hasChildren : true } );
              var node13 = treeBrowser.createNode( node1, { name: "Node1_3", hasChildren : true } );
              var node14 = treeBrowser.createNode( node1, { name: "Node1_4", hasChildren : true } );
              var node15 = treeBrowser.createNode( node1, { name: "Node1_5", hasChildren : true } );

              //remove node3 just for fun
              treeBrowser.deleteNode(node3);

              //handle node open
              treeBrowser.onNodeOpen = function( node ) {
                  var that = this;
                  setTimeout( function () {
                      that.createNode( node, { name: "Child1", hasChildren : false } );
                      that.createNode( node, { name: "Child2", hasChildren : false } );
                      that.createNode( node, { name: "Child3", hasChildren : false } );
                      that.createNode( node, { name: "Child4", hasChildren : false } );
                  }, 1000 );
              }

              //node3 does not exist but try to rename it
              treeBrowser.setCustomData( node3, { x: "soonToBeDeleted" } );
              setTimeout( function() { treeBrowser.renameNode( node3, "Node3 upadted" ); }, 2000 );

              //node4 rename
              treeBrowser.setCustomData( node4, { x: 1, y: 2 } );
              setTimeout( function() { treeBrowser.renameNode( node4, "Node4 updated" ); }, 4000 );


              //create new child to node1
              treeBrowser.setCustomData( node1, { a: 1, b: 2, c: node4 } );
              setTimeout( function() {
                  var node1_1 = treeBrowser.createNode( node1, { name: "Child5_autoadded", hasChildren : false } );
                  //window.logMessage( node1_1.getParent() );

              }, 5000 );

              var customData4 = treeBrowser.getCustomData( node4 );
              var customData1 = treeBrowser.getCustomData( node1 );
              var customData3 = treeBrowser.getCustomData( node3);

              /*treeBrowser.onNodeTitleChanged = function( node, oldText, newText ) {
                  //accept namechange
                  return false;
              }*/
              /*************ENDOF TreeBrowserWidget with DYNATREE *********************/

              /*************TreeBrowserWidget with JSTREE *********************/
              var treeBrowserJSTree = new JSTreeBrowserWidget( "dJSTreeBrowser" );

              //toplevel items
              setTimeout( function () {
                  var jsnode1 = treeBrowserJSTree.createNode( null, { name: "Node1", hasChildren : true } );
                  var jsnode2 = treeBrowserJSTree.createNode( null, { name: "Node2", hasChildren : true } );
                  var jsnode3 = treeBrowserJSTree.createNode( null, { name: "Node3", hasChildren : true } );
                  var jsnode4 = treeBrowserJSTree.createNode( null, { name: "Node4", hasChildren : true } );
                  var jsnode5 = treeBrowserJSTree.createNode( null, { name: "Node5", hasChildren : false } );

                  var jsnode11 = treeBrowserJSTree.createNode( jsnode1, { name: "Node11", hasChildren : false } );
                  var jsnode12 = treeBrowserJSTree.createNode( jsnode1, { name: "Node12", hasChildren : false } );
                  var jsnode13 = treeBrowserJSTree.createNode( jsnode1, { name: "Node13", hasChildren : false } );
                  var jsnode14 = treeBrowserJSTree.createNode( jsnode1, { name: "Node14", hasChildren : false } );
                  var jsnode15 = treeBrowserJSTree.createNode( jsnode1, { name: "Node15", hasChildren : false } );

                  //remove jsnode3 just for fun
                  treeBrowserJSTree.deleteNode(jsnode3);

                  //handle node open
                  treeBrowserJSTree.onNodeOpen = function( node ) {
                      var that = this;
                      setTimeout( function () {
                          that.createNode( node, { name: "Child1", hasChildren : false } );
                          that.createNode( node, { name: "Child2", hasChildren : false } );
                          that.createNode( node, { name: "Child3", hasChildren : false } );
                          that.createNode( node, { name: "Child4", hasChildren : false } );
                          that.lazyLoadFinished( node );
                      }, 1000 );
                  }

                  treeBrowserJSTree.expand( jsnode1 );
                  treeBrowserJSTree.expand( jsnode2 );

                  setTimeout( function() { treeBrowserJSTree.renameNode( jsnode4, "Node4 updated" ); }, 4000 );

                  setTimeout( function() { treeBrowserJSTree.expandTree(); }, 6000 );

                  /*setTimeout( function() { treeBrowserJSTree.clear(); }, 8000 );*/

              }, 0);

              /*************ENDOF TreeBrowserWidget with JSTREE *********************/
          });
        </script>
    </head>
    <body>
        <div id="dTreeBrowser">
        </div>
        <div style="width:300px;height:0px;border: 1px solid #000000"></div>
        <div id="dJSTreeBrowser">
        </div>
    </body>
</html>