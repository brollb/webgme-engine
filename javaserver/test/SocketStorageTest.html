<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>GmeCore Testing</title>
		<script src="js/lib/require.js"></script>
		<script>
            var downloadedobjects = {};
            var project = undefined;
			require(["js/gmestorage"], function(storage) {
                var mysocket = storage.createSocket();

				console.log("START");
				project = storage.createProject();
				project.open(mysocket,"peloproject");

                extendobjects = function(){
                    alert("mindjart!!!");
                    var request = storage.createRequest(project);
                    mysocket.query(request);
                    var haschildrens = false;
                    var haselements = false;
                    for(var i in downloadedobjects){
                        haselements = true;
                        var obj = downloadedobjects[i];
                        for(var j in obj.children){
                            haschildrens=true;
                            request.loadObject(obj.children[j]);
                        }
                    };
                    if(!haselements){
                        //download the root
                        request.loadRoot();
                        request.send();
                    }
                    else if(!haschildrens){
                        alert("there are no more children to download");
                    }
                    else{
                        request.send();
                    }

                    request.ondone = function(){
                        for(var i in request.objects){
                            downloadedobjects[i] = request.objects[i];
                        }
                        printobjects();
                    }
                    request.onerror = function(){
                        alert("valami gebasz van");
                    }
                };
			});

            printobjects = function(){
                var text = "";
                for(var i in downloadedobjects){
                    text+="OBJECT ["+i+"] "+JSON.stringify(downloadedobjects[i])+"<br/>";
                }
                document.getElementById("downloadedones").innerHTML = text;
            };

		</script>
		<style>
			.subLevel { margin-left: 100px; }
		</style>
	</head>
	<body>
		<div id="myContent" style="font-family: Courier new">
		</div>
        <input type="button" id=loadonelevel onclick="extendobjects()" value="expand tree"/>
        <p id="downloadedones">here will be printed out the downloaded objects</p>
	</body>
</html>
