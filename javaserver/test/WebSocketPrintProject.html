<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>This page show the already created project elements</title>
	<script>
		var showed=false;
		showHideLS = function(){
			if(showed){
				showed=false;
				document.getElementById("lsbutton").value = "show local storage";
				document.getElementById("lscontainer").innerText = "";
			}
			else{
				showed=true;
				document.getElementById("lsbutton").value = "hide local storage";
				document.getElementById("lscontainer").innerText = JSON.stringify(localStorage);
			}
		}
	</script>
	<script src="js/lib/require.js"></script>
	<script>
		require(["js/gmestorage_ws"], function(storage) {
			var projectopened=false;
			var widgetobjects = {};
			var project = storage.createProject();
			
			fetchNextLevel = function(){
				if(projectopened==false){
					alert("the project not opened yet!!!");
					return;
				}
				var request=project.createRequest();
				request.ondone = function(){
					//we save all the objects to our container as well
					for(var i in request.objects){
						widgetobjects[i] = request.objects[i];
					}
					document.getElementById("elementcontainer").innerText = JSON.stringify(widgetobjects);
				};
				var wassomething=false;
				var waschildren=false;
				for(var i in widgetobjects){
					wassomething=true;
					for(var j in widgetobjects[i].children){
						if(widgetobjects[widgetobjects[i].children[j]]==undefined){
							waschildren=true;
							request.loadObject(widgetobjects[i].children[j]);
						}
					}
				}
				if(!wassomething){
					request.loadRoot();
					request.send();
				}
				else{
					if(!waschildren){
						alert("all available data is downloaded");
					}
					else{
						request.send();
					}
				}
			};
			project.onopen = function(){
				projectopened=true;
			}
			//START
			project.open("ws://localhost:8081/ws");
		});
	</script>
</head>
<body>
	<div id=buttoncontainer>
		<input type="button" id="fetchbutton" value="fetch next level" onclick="fetchNextLevel()"/>
		<input type="button" id="lsbutton" value="show local storage" onclick="showHideLS()"/>
		<a href="index.html">main page</a><br/>
		<p id="lscontainer"></p>
	</div>
	<div>
		<h3>Here will be shown the loaded objects from the project</h3>
		<p id="elementcontainer"></p>
	</div>
</body>
</html>